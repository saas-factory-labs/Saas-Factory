@* Text input component with label, validation, and icons *@

<div class="@ContainerClass">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="block text-sm font-medium mb-1 @LabelClasses" for="@Id">
            @Label
            @if (Required)
            {
                <span class="text-red-500">*</span>
            }
        </label>
    }
    <div class="relative">
        @if (PrefixIcon != null)
        {
            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-400 dark:text-gray-500">
                @PrefixIcon
            </div>
        }
        <input
            type="@Type"
            id="@Id"
            name="@Name"
            class="@GetInputClasses()"
            placeholder="@Placeholder"
            value="@Value"
            disabled="@Disabled"
            readonly="@Readonly"
            required="@Required"
            @oninput="OnInput"
            @onblur="OnBlur"
            @attributes="AdditionalAttributes" />
        @if (SuffixIcon != null)
        {
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400 dark:text-gray-500">
                @SuffixIcon
            </div>
        }
        @if (HasError && !string.IsNullOrEmpty(ErrorMessage))
        {
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg class="fill-current text-red-500" width="16" height="16" viewBox="0 0 16 16">
                    <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm3.5 10.1l-1.4 1.4L8 9.4l-2.1 2.1-1.4-1.4L6.6 8 4.5 5.9l1.4-1.4L8 6.6l2.1-2.1 1.4 1.4L9.4 8l2.1 2.1z" />
                </svg>
            </div>
        }
    </div>
    @if (!string.IsNullOrEmpty(HelpText) && !HasError)
    {
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">@HelpText</p>
    }
    @if (HasError && !string.IsNullOrEmpty(ErrorMessage))
    {
        <p class="text-xs text-red-500 mt-1">@ErrorMessage</p>
    }
</div>

@code {
    [Parameter] public string? Id { get; set; }
    [Parameter] public string? Name { get; set; }
    [Parameter] public string Type { get; set; } = "text";
    [Parameter] public string? Label { get; set; }
    [Parameter] public string? Placeholder { get; set; }
    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    [Parameter] public string? HelpText { get; set; }
    [Parameter] public string? ErrorMessage { get; set; }
    [Parameter] public bool HasError { get; set; } = false;
    [Parameter] public bool Disabled { get; set; } = false;
    [Parameter] public bool Readonly { get; set; } = false;
    [Parameter] public bool Required { get; set; } = false;
    [Parameter] public string Size { get; set; } = "md"; // sm, md, lg
    [Parameter] public RenderFragment? PrefixIcon { get; set; }
    [Parameter] public RenderFragment? SuffixIcon { get; set; }
    [Parameter] public string? ContainerClass { get; set; }
    [Parameter(CaptureUnmatchedValues = true)] public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string LabelClasses => HasError ? "text-red-500" : "text-gray-800 dark:text-gray-100";

    private string GetInputClasses()
    {
        var sizeClasses = Size switch
        {
            "sm" => "py-1.5 text-sm",
            "lg" => "py-3 text-base",
            _ => "py-2 text-sm"
        };

        var paddingLeft = PrefixIcon != null ? "pl-10" : "pl-3";
        var paddingRight = SuffixIcon != null || HasError ? "pr-10" : "pr-3";

        var stateClasses = HasError
            ? "border-red-500 focus:border-red-500 focus:ring-red-500/20"
            : Disabled
                ? "border-gray-200 dark:border-gray-700/60 bg-gray-100 dark:bg-gray-900/50 text-gray-400 cursor-not-allowed"
                : "border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 focus:border-violet-300 dark:focus:border-violet-500/50";

        return $"form-input w-full {sizeClasses} {paddingLeft} {paddingRight} bg-white dark:bg-gray-800 {stateClasses} rounded-lg";
    }

    private async Task OnInput(ChangeEventArgs e)
    {
        Value = e.Value?.ToString();
        await ValueChanged.InvokeAsync(Value);
    }

    private void OnBlur()
    {
        // Can be extended for validation on blur
    }
}

@* Select dropdown component with label and validation *@

<div class="@ContainerClass">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="block text-sm font-medium mb-1 @LabelClasses" for="@Id">
            @Label
            @if (Required)
            {
                <span class="text-red-500">*</span>
            }
        </label>
    }
    <select
        id="@Id"
        name="@Name"
        class="@GetSelectClasses()"
        disabled="@Disabled"
        required="@Required"
        @onchange="OnChange"
        @attributes="AdditionalAttributes">
        @if (!string.IsNullOrEmpty(Placeholder))
        {
            <option value="" disabled selected="@(string.IsNullOrEmpty(Value))">@Placeholder</option>
        }
        @foreach (var option in Options)
        {
            <option value="@option.Value" selected="@(Value == option.Value)">@option.Label</option>
        }
    </select>
    @if (!string.IsNullOrEmpty(HelpText) && !HasError)
    {
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">@HelpText</p>
    }
    @if (HasError && !string.IsNullOrEmpty(ErrorMessage))
    {
        <p class="text-xs text-red-500 mt-1">@ErrorMessage</p>
    }
</div>

@code {
    [Parameter] public string? Id { get; set; }
    [Parameter] public string? Name { get; set; }
    [Parameter] public string? Label { get; set; }
    [Parameter] public string? Placeholder { get; set; }
    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    [Parameter] public List<SelectOption> Options { get; set; } = new();
    [Parameter] public string? HelpText { get; set; }
    [Parameter] public string? ErrorMessage { get; set; }
    [Parameter] public bool HasError { get; set; } = false;
    [Parameter] public bool Disabled { get; set; } = false;
    [Parameter] public bool Required { get; set; } = false;
    [Parameter] public string Size { get; set; } = "md"; // sm, md, lg
    [Parameter] public string? ContainerClass { get; set; }
    [Parameter(CaptureUnmatchedValues = true)] public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string LabelClasses => HasError ? "text-red-500" : "text-gray-800 dark:text-gray-100";

    private string GetSelectClasses()
    {
        var sizeClasses = Size switch
        {
            "sm" => "py-1.5 text-sm",
            "lg" => "py-3 text-base",
            _ => "py-2 text-sm"
        };

        var stateClasses = HasError
            ? "border-red-500 focus:border-red-500 focus:ring-red-500/20"
            : Disabled
                ? "border-gray-200 dark:border-gray-700/60 bg-gray-100 dark:bg-gray-900/50 text-gray-400 cursor-not-allowed"
                : "border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 focus:border-violet-300 dark:focus:border-violet-500/50";

        return $"form-select w-full {sizeClasses} bg-white dark:bg-gray-800 {stateClasses} rounded-lg";
    }

    private async Task OnChange(ChangeEventArgs e)
    {
        Value = e.Value?.ToString();
        await ValueChanged.InvokeAsync(Value);
    }

    public class SelectOption
    {
        public string Value { get; set; } = "";
        public string Label { get; set; } = "";
    }
}

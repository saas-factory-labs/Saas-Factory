@page "/tables"
@using System.Globalization

<PageTitle>Tables</PageTitle>

<div class="px-4 sm:px-6 lg:px-8 py-8 w-full max-w-[96rem] mx-auto">

    <!-- Page header -->
    <div class="sm:flex sm:justify-between sm:items-center mb-8">

        <!-- Left: Title -->
        <div class="mb-4 sm:mb-0">
            <h1 class="text-2xl md:text-3xl text-gray-800 dark:text-gray-100 font-bold outline-none">Customers</h1>
        </div>

        <!-- Right: Actions -->
        <div class="grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-2">

            <!-- Delete button -->
            <div class="@(selectedCustomers.Count > 0 ? "" : "hidden")">
                <button class="btn bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-rose-500">Delete</button>
            </div>

            <!-- Dropdown -->
            <div class="relative">
                <button class="btn justify-between min-w-44 bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-gray-500 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-200" aria-label="Select date range" aria-haspopup="true">
                    <span class="flex items-center">
                        <svg class="fill-current text-gray-400 dark:text-gray-500 shrink-0 mr-2" width="16" height="16" viewBox="0 0 16 16">
                            <path d="M5 4a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2H5Z"/>
                            <path d="M4 0a4 4 0 0 0-4 4v8a4 4 0 0 0 4 4h8a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4H4ZM2 4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4Z"/>
                        </svg>
                        <span>Last Month</span>
                    </span>
                    <svg class="fill-current text-gray-400 dark:text-gray-500 shrink-0 ml-1" width="11" height="7" viewBox="0 0 11 7">
                        <path d="M5.4 6.8L0 1.4 1.4 0l4 4 4-4 1.4 1.4z"/>
                    </svg>
                </button>
            </div>

            <!-- Filter button -->
            <div class="relative inline-flex">
                <button class="btn bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-gray-500 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-200">
                    <span class="sr-only">Filter</span><wbr>
                    <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16">
                        <path d="M0 3a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2H1a1 1 0 0 1-1-1ZM3 8a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2H4a1 1 0 0 1-1-1ZM7 12a1 1 0 1 0 0 2h2a1 1 0 1 0 0-2H7Z"/>
                    </svg>
                </button>
            </div>

            <!-- Add customer button -->
            <button class="btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white">
                <svg class="fill-current shrink-0 xs:hidden" width="16" height="16" viewBox="0 0 16 16">
                    <path d="M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z"/>
                </svg>
                <span class="max-xs:sr-only">Add Customer</span>
            </button>

        </div>

    </div>

    <!-- Table -->
    <div class="bg-white dark:bg-gray-800 shadow-xs rounded-xl relative">
        <header class="px-5 py-4">
            <h2 class="font-semibold text-gray-800 dark:text-gray-100">All Customers <span class="text-gray-400 dark:text-gray-500 font-medium">@customers.Count</span></h2>
        </header>
        <div>

            <!-- Table -->
            <div class="overflow-x-auto">
                <table class="table-auto w-full dark:text-gray-300">
                    <!-- Table header -->
                    <thead class="text-xs font-semibold uppercase text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/20 border-t border-b border-gray-100 dark:border-gray-700/60">
                    <tr>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px">
                            <div class="flex items-center">
                                <label class="inline-flex">
                                    <span class="sr-only">Select all</span>
                                    <input class="form-checkbox" type="checkbox" checked="@AllSelected" @onchange="ToggleSelectAll"/>
                                </label>
                            </div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px">
                            <span class="sr-only">Favourite</span>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                            <div class="font-semibold text-left">Order</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                            <div class="font-semibold text-left">Email</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                            <div class="font-semibold text-left">Location</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                            <div class="font-semibold">Orders</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                            <div class="font-semibold text-left">Last order</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                            <div class="font-semibold text-left">Total spent</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                            <div class="font-semibold">Refunds</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                            <span class="sr-only">Menu</span>
                        </th>
                    </tr>
                    </thead>
                    <!-- Table body -->
                    <tbody class="text-sm divide-y divide-gray-100 dark:divide-gray-700/60">
                    @foreach (var customer in customers)
                    {
                        <tr>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px">
                                <div class="flex items-center">
                                    <label class="inline-flex">
                                        <span class="sr-only">Select</span>
                                        <input class="form-checkbox" type="checkbox" checked="@selectedCustomers.Contains(customer.Id)" @onchange="@(e => ToggleSelection(customer.Id))"/>
                                    </label>
                                </div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px">
                                <div class="flex items-center relative">
                                    <button>
                                        <svg class="shrink-0 fill-current @(customer.Fav ? "text-yellow-500" : "text-gray-300 dark:text-gray-600")" width="16" height="16" viewBox="0 0 16 16">
                                            <path d="M8 0L6 5.934H0l4.89 3.954L2.968 16 8 12.223 13.032 16 11.11 9.888 16 5.934h-6L8 0z"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 shrink-0 mr-2 sm:mr-3">
                                        <img class="rounded-full" src="@customer.Image" width="40" height="40" alt="@customer.Name"/>
                                    </div>
                                    <div class="font-medium text-gray-800 dark:text-gray-100">@customer.Name</div>
                                </div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                                <div class="text-left">@customer.Email</div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                                <div class="text-left">@customer.Location</div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                                <div class="text-center">@customer.Orders</div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                                <div class="text-left font-medium text-sky-600">@customer.LastOrder</div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                                <div class="text-left font-medium text-green-600">@customer.Spent</div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
                                <div class="text-center">@customer.Refunds</div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px">
                                <!-- Menu button -->
                                <button class="text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-400 rounded-full">
                                    <span class="sr-only">Menu</span>
                                    <svg class="w-8 h-8 fill-current" viewBox="0 0 32 32">
                                        <circle cx="16" cy="16" r="2"/>
                                        <circle cx="10" cy="16" r="2"/>
                                        <circle cx="22" cy="16" r="2"/>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>

            </div>
        </div>
    </div>

    <!-- Pagination -->
    <div class="mt-8">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <nav class="mb-4 sm:mb-0 sm:order-1" role="navigation" aria-label="Navigation">
                <ul class="flex justify-center">
                    <li class="ml-3 first:ml-0">
                        <span class="btn bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-300 dark:text-gray-600">Previous</span>
                    </li>
                    <li class="ml-3 first:ml-0">
                        <a class="btn bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-violet-500" href="#0">Next</a>
                    </li>
                </ul>
            </nav>
            <div class="text-sm text-gray-500 dark:text-gray-400 text-center sm:text-left">
                Showing <span class="font-medium text-gray-600 dark:text-gray-300">1</span> to <span class="font-medium text-gray-600 dark:text-gray-300">10</span> of <span class="font-medium text-gray-600 dark:text-gray-300">467</span> results
            </div>
        </div>
    </div>

</div>

@code {
    private List<Customer> customers = new();
    private HashSet<string> selectedCustomers = new();

    private bool AllSelected => customers.Count > 0 && selectedCustomers.Count == customers.Count;

    protected override void OnInitialized()
    {
        // Mock data matching Vue template
        customers = new List<Customer>
        {
            new() { Id = "0", Image = "https://i.pravatar.cc/150?u=0", Name = "Patricia Semklo", Email = "patricia.semklo@app.com", Location = "ðŸ‡¬ðŸ‡§ London, UK", Orders = "24", LastOrder = "#123567", Spent = "$2,890.66", Refunds = "-", Fav = true },
            new() { Id = "1", Image = "https://i.pravatar.cc/150?u=1", Name = "Dominik Lamakani", Email = "dominik.lamakani@gmail.com", Location = "ðŸ‡©ðŸ‡ª Dortmund, DE", Orders = "77", LastOrder = "#779912", Spent = "$14,767.04", Refunds = "4", Fav = false },
            new() { Id = "2", Image = "https://i.pravatar.cc/150?u=2", Name = "Ivan Mesaros", Email = "imivanmes@gmail.com", Location = "ðŸ‡«ðŸ‡· Paris, FR", Orders = "44", LastOrder = "#889924", Spent = "$4,996.00", Refunds = "1", Fav = true },
            new() { Id = "3", Image = "https://i.pravatar.cc/150?u=3", Name = "Maria Martinez", Email = "martinezhome@gmail.com", Location = "ðŸ‡®ðŸ‡¹ Bologna, IT", Orders = "29", LastOrder = "#897726", Spent = "$3,220.66", Refunds = "2", Fav = false },
            new() { Id = "4", Image = "https://i.pravatar.cc/150?u=4", Name = "Vicky Jung", Email = "itsvicky@contact.com", Location = "ðŸ‡¬ðŸ‡§ London, UK", Orders = "22", LastOrder = "#123567", Spent = "$2,890.66", Refunds = "-", Fav = true },
            new() { Id = "5", Image = "https://i.pravatar.cc/150?u=5", Name = "Tisho Yanchev", Email = "tisho.y@kurlytech.com", Location = "ðŸ‡¬ðŸ‡§ London, UK", Orders = "14", LastOrder = "#896644", Spent = "$1,649.99", Refunds = "1", Fav = true },
            new() { Id = "6", Image = "https://i.pravatar.cc/150?u=6", Name = "James Cameron", Email = "james.ceo@james.tech", Location = "ðŸ‡«ðŸ‡· Marseille, FR", Orders = "34", LastOrder = "#136988", Spent = "$3,569.87", Refunds = "2", Fav = true },
            new() { Id = "7", Image = "https://i.pravatar.cc/150?u=7", Name = "Haruki Masuno", Email = "haruki@supermail.jp", Location = "ðŸ‡¯ðŸ‡µ Tokio, JP", Orders = "112", LastOrder = "#442206", Spent = "$19,246.07", Refunds = "6", Fav = false },
            new() { Id = "8", Image = "https://i.pravatar.cc/150?u=8", Name = "Joe Huang", Email = "joehuang@hotmail.com", Location = "ðŸ‡¨ðŸ‡³ Shanghai, CN", Orders = "64", LastOrder = "#764321", Spent = "$12,276.92", Refunds = "-", Fav = true },
            new() { Id = "9", Image = "https://i.pravatar.cc/150?u=9", Name = "Carolyn McNeail", Email = "carolynlove@gmail.com", Location = "ðŸ‡®ðŸ‡¹ Milan, IT", Orders = "19", LastOrder = "#908764", Spent = "$1,289.97", Refunds = "2", Fav = false }
        };
    }

    private void ToggleSelection(string id)
    {
        if (selectedCustomers.Contains(id))
        {
            selectedCustomers.Remove(id);
        }
        else
        {
            selectedCustomers.Add(id);
        }
    }

    private void ToggleSelectAll(ChangeEventArgs e)
    {
        if ((bool)(e.Value ?? false))
        {
            foreach (var customer in customers)
            {
                selectedCustomers.Add(customer.Id);
            }
        }
        else
        {
            selectedCustomers.Clear();
        }
    }

    private class Customer
    {
        public string Id { get; set; } = "";
        public string Image { get; set; } = "";
        public string Name { get; set; } = "";
        public string Email { get; set; } = "";
        public string Location { get; set; } = "";
        public string Orders { get; set; } = "";
        public string LastOrder { get; set; } = "";
        public string Spent { get; set; } = "";
        public string Refunds { get; set; } = "";
        public bool Fav { get; set; }
    }

}

@page "/inbox"
@inject ThemeService ThemeService

<div class="relative flex h-full">

    <!-- Inbox sidebar -->
    <div id="inbox-sidebar"
         class="absolute z-20 top-0 bottom-0 w-full md:w-auto md:static md:top-auto md:bottom-auto -mr-px md:translate-x-0 transition-transform duration-200 ease-in-out @(inboxSidebarOpen ? "translate-x-0" : "-translate-x-full")">
        <div class="sticky top-16 bg-white dark:bg-gray-900 overflow-x-hidden overflow-y-auto no-scrollbar shrink-0 border-r border-gray-200 dark:border-gray-700 md:w-72 xl:w-80 h-[calc(100dvh-64px)]">

            <!-- Group header -->
            <div class="sticky top-0 z-10">
                <div class="flex items-center bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-5 h-16">
                    <div class="w-full flex items-center justify-between">
                        <!-- Channel menu -->
                        <div class="relative inline-flex">
                            <button class="btn justify-between min-w-44 bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-gray-500 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-200">
                                <span class="flex items-center">
                                    <span># Marketing</span>
                                </span>
                                <svg class="shrink-0 ml-1 fill-current text-gray-400" width="11" height="7" viewBox="0 0 11 7">
                                    <path d="M5.4 6.8L0 1.4 1.4 0l4 4 4-4 1.4 1.4z"/>
                                </svg>
                            </button>
                        </div>
                        <!-- Edit button -->
                        <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                            <svg class="w-4 h-4 fill-current text-gray-500" viewBox="0 0 16 16">
                                <path d="M11.7.3c-.4-.4-1-.4-1.4 0l-10 10c-.2.2-.3.4-.3.7v4c0 .6.4 1 1 1h4c.3 0 .5-.1.7-.3l10-10c.4-.4.4-1 0-1.4l-4-4zM4.6 14H2v-2.6l6-6L10.6 8l-6 6zM12 6.6L9.4 4 11 2.4 13.6 5 12 6.6z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Group body -->
            <div class="px-5 py-4">
                <!-- Search form -->
                <form class="relative">
                    <label for="inbox-search" class="sr-only">Search</label>
                    <input id="inbox-search" class="form-input w-full pl-9 bg-white dark:bg-gray-800" type="search" placeholder="Search..."/>
                    <button class="absolute inset-0 right-auto group" type="submit" aria-label="Search">
                        <svg class="w-4 h-4 shrink-0 fill-current text-gray-400 dark:text-gray-500 group-hover:text-gray-500 dark:group-hover:text-gray-400 ml-3 mr-2" viewBox="0 0 16 16">
                            <path d="M7 14c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zM7 2C4.243 2 2 4.243 2 7s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5z"/>
                            <path d="M15.707 14.293L13.314 11.9a8.019 8.019 0 01-1.414 1.414l2.393 2.393a.997.997 0 001.414 0 .999.999 0 000-1.414z"/>
                        </svg>
                    </button>
                </form>

                <!-- Tabs -->
                <div class="relative mt-4">
                    <div class="absolute bottom-0 w-full h-px bg-gray-200 dark:bg-gray-700" aria-hidden="true"></div>
                    <ul class="relative text-sm font-medium flex flex-nowrap -mx-4 sm:-mx-6 lg:-mx-8 overflow-x-scroll no-scrollbar">
                        <li class="mr-6 last:mr-0 first:pl-4 sm:first:pl-6 lg:first:pl-8 last:pr-4 sm:last:pr-6 lg:last:pr-8">
                            <a class="block pb-3 @ThemeService.GetPrimaryClass("text", "500") whitespace-nowrap border-b-2 @ThemeService.GetPrimaryClass("border", "500")" href="#0">Primary</a>
                        </li>
                        <li class="mr-6 last:mr-0 first:pl-4 sm:first:pl-6 lg:first:pl-8 last:pr-4 sm:last:pr-6 lg:last:pr-8">
                            <a class="block pb-3 text-gray-500 dark:text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 whitespace-nowrap" href="#0">Social</a>
                        </li>
                        <li class="mr-6 last:mr-0 first:pl-4 sm:first:pl-6 lg:first:pl-8 last:pr-4 sm:last:pr-6 lg:last:pr-8">
                            <a class="block pb-3 text-gray-500 dark:text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 whitespace-nowrap" href="#0">Promotions</a>
                        </li>
                    </ul>
                </div>

                <!-- Inbox -->
                <div class="mt-4">
                    <div class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase mb-3">Inbox (44)</div>
                    <ul class="mb-6">
                        @foreach (var email in emails)
                        {
                            <li class="-mx-2">
                                <button class="flex w-full p-2 rounded @(email.Selected ? $"{ThemeService.GetPrimaryClass("bg", "100")} dark:{ThemeService.GetPrimaryClass("bg", "500")}/30" : "") text-left" @onclick="() => SelectEmail(email)">
                                    <img class="w-8 h-8 rounded-full mr-2" src="@email.Avatar" width="32" height="32" alt="@email.Sender"/>
                                    <div class="grow truncate">
                                        <div class="flex items-center justify-between mb-1.5">
                                            <div class="truncate">
                                                <span class="text-sm font-semibold text-gray-800 dark:text-gray-100">@email.Sender</span>
                                            </div>
                                            <div class="text-xs text-gray-500 font-medium">@email.Date</div>
                                        </div>
                                        <div class="text-xs font-medium text-gray-800 dark:text-gray-100 truncate mb-0.5">@email.Subject</div>
                                        <div class="text-xs whitespace-normal">@email.Preview</div>
                                    </div>
                                </button>
                            </li>
                        }
                    </ul>
                </div>
            </div>

        </div>
    </div>

    <!-- Inbox body -->
    <div class="grow flex flex-col md:translate-x-0 transition-transform duration-300 ease-in-out @(inboxSidebarOpen ? "translate-x-1/3" : "translate-x-0")">

        <!-- Header -->
        <div class="sticky top-16">
            <div class="flex items-center justify-between bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700 px-4 sm:px-6 md:px-5 h-16">
                <!-- Buttons on the left side -->
                <div class="flex">
                    <!-- Close button -->
                    <button class="md:hidden text-gray-400 hover:text-gray-500 mr-4" @onclick="() => inboxSidebarOpen = !inboxSidebarOpen">
                        <span class="sr-only">Close sidebar</span>
                        <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24">
                            <path d="M10.7 18.7l1.4-1.4L7.8 13H20v-2H7.8l4.3-4.3-1.4-1.4L4 12z"/>
                        </svg>
                    </button>
                    <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                        <svg class="w-4 h-4 fill-current text-gray-400 dark:text-gray-500" viewBox="0 0 16 16">
                            <path d="M5 7h2v6H5V7zm4 0h2v6H9V7zm3-6v2h4v2h-1v10c0 .6-.4 1-1 1H2c-.6 0-1-.4-1-1V5H0V3h4V1c0-.6.4-1 1-1h6c.6 0 1 .4 1 1zM6 2v1h4V2H6zm7 3H3v9h10V5z"/>
                        </svg>
                    </button>
                    <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                        <svg class="w-4 h-4 fill-current text-amber-500" viewBox="0 0 16 16">
                            <path d="M10 5.934 8 0 6 5.934H0l4.89 3.954L2.968 16 8 12.223 13.032 16 11.11 9.888 16 5.934z"/>
                        </svg>
                    </button>
                    <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                        <svg class="w-4 h-4 fill-current text-gray-400 dark:text-gray-500" viewBox="0 0 16 16">
                            <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 12c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm1-3H7V4h2v5z"/>
                        </svg>
                    </button>
                    <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                        <svg class="w-4 h-4 fill-current @ThemeService.GetPrimaryClass("text", "500")" viewBox="0 0 16 16">
                            <path d="M14.3 2.3L5 11.6 1.7 8.3c-.4-.4-1-.4-1.4 0-.4.4-.4 1 0 1.4l4 4c.2.2.4.3.7.3.3 0 .5-.1.7-.3l10-10c.4-.4.4-1 0-1.4-.4-.4-1-.4-1.4 0z"/>
                        </svg>
                    </button>
                </div>
                <!-- Buttons on the right side -->
                <div class="flex items-center">
                    <div class="text-xs mr-1">
                        <span class="font-medium dark:text-gray-300">10</span> <span class="text-gray-500 dark:text-gray-400">of</span> <span class="font-medium dark:text-gray-300">467</span>
                    </div>
                    <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                        <svg class="w-4 h-4 fill-current" viewBox="0 0 16 16">
                            <path d="m10 13.4 1.4-1.4-4-4 4-4L10 2.6 4.6 8z"/>
                        </svg>
                    </button>
                    <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                        <svg class="w-4 h-4 fill-current" viewBox="0 0 16 16">
                            <path d="M7 13.4 5.6 12l4-4-4-4L7 2.6 12.4 8z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Body -->
        <div class="grow px-4 sm:px-6 md:px-5 py-4">

            <!-- Mail subject -->
            <header class="sm:flex sm:items-start sm:justify-between mb-4">
                <h1 class="text-xl leading-snug text-gray-800 dark:text-gray-100 font-bold mb-1 sm:mb-0 ml-2">@selectedEmail?.Subject</h1>
                <button class="text-xs inline-flex font-medium @ThemeService.GetAccentClass("bg", "100") dark:@ThemeService.GetAccentClass("bg", "500")/30 @ThemeService.GetAccentClass("text", "600") dark:@ThemeService.GetAccentClass("text", "400") rounded-full text-center px-2.5 py-1 whitespace-nowrap">Exciting news</button>
            </header>

            <!-- Messages box -->
            <div class="bg-white dark:bg-gray-800 shadow-xs rounded-xl border border-gray-200 dark:border-gray-700 px-6 divide-y divide-gray-200 dark:divide-gray-700">
                @foreach (var mail in mailMessages)
                {
                    <div class="py-4">
                        <header class="flex items-start mb-2">
                            <img class="rounded-full shrink-0 mr-3" src="@mail.Avatar" width="40" height="40" alt="@mail.Name"/>
                            <div class="grow">
                                <div class="sm:flex items-start justify-between mb-0.5">
                                    <div class="xl:flex items-center mb-2 sm:mb-0">
                                        <div class="text-sm font-semibold text-gray-800 dark:text-gray-100">@mail.Name</div>
                                        <div class="text-sm text-gray-500 xl:ml-2">@mail.Email</div>
                                    </div>
                                    <div class="text-xs font-medium text-gray-500">@mail.Date</div>
                                </div>
                                <div class="text-xs font-medium text-gray-500">To: @string.Join(", ", mail.Recipients)</div>
                            </div>
                        </header>
                        <div class="text-sm text-gray-800 dark:text-gray-100 space-y-2">
                            @((MarkupString)mail.Message)
                        </div>
                    </div>
                }
            </div>

        </div>

        <!-- Footer -->
        <div class="sticky bottom-0">
            <div class="flex items-center justify-between bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 px-4 sm:px-6 md:px-5 h-16">
                <!-- Plus button -->
                <button class="shrink-0 text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400 mr-3">
                    <span class="sr-only">Add</span>
                    <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12C23.98 5.38 18.62.02 12 0zm6 13h-5v5h-2v-5H6v-2h5V6h2v5h5v2z"/>
                    </svg>
                </button>
                <!-- Message input -->
                <form class="grow flex">
                    <div class="grow mr-3">
                        <label for="message-input" class="sr-only">Type a message</label>
                        <input id="message-input" class="form-input w-full bg-gray-100 dark:bg-gray-800 border-transparent dark:border-transparent focus:bg-white dark:focus:bg-gray-800 placeholder-gray-500" type="text" placeholder="Aa"/>
                    </div>
                    <button type="submit" class="@ThemeService.GetPrimaryButtonClasses() whitespace-nowrap">Send -&gt;</button>
                </form>
            </div>
        </div>

    </div>

</div>

@code {
    private bool inboxSidebarOpen;
    private List<EmailItem> emails = new();
    private EmailItem? selectedEmail;
    private List<MailMessage> mailMessages = new();

    protected override void OnInitialized()
    {
        emails = new List<EmailItem>
        {
            new() { Avatar = "_content/AppBlueprint.UiKit/images/user-32-01.jpg", Sender = "Dominik Lamakani", Date = "4 Aug", Subject = "Chill your mind with this amazing offer", Preview = "Lorem ipsum dolor sit amet, consecte adipiscing elit aute irure dolor...", Selected = true },
            new() { Avatar = "_content/AppBlueprint.UiKit/images/user-32-05.jpg", Sender = "Simona LÃ¼rwer", Date = "4 Aug", Subject = "Help us improve Mosaic by giving...", Preview = "Lorem ipsum dolor sit amet, consecte adipiscing elit aute irure dolor..." },
            new() { Avatar = "_content/AppBlueprint.UiKit/images/user-32-06.jpg", Sender = "Mary Roszczewski", Date = "1 Aug", Subject = "[Urgent] Changes to links for public...", Preview = "Lorem ipsum dolor sit amet, consecte adipiscing elit aute irure dolor..." },
            new() { Avatar = "_content/AppBlueprint.UiKit/images/user-32-04.jpg", Sender = "Adrian Przetocki", Date = "1 Aug", Subject = "Help us improve Mosaic by giving...", Preview = "Lorem ipsum dolor sit amet, consecte adipiscing elit aute irure dolor..." },
            new() { Avatar = "_content/AppBlueprint.UiKit/images/user-32-02.jpg", Sender = "Tisha Yanchev", Date = "1 Aug", Subject = "Re: Here's an extra 25% OFF", Preview = "Excepteur sint occaecat cupidatat non proident sunt in culpa qui deserunt..." },
        };

        selectedEmail = emails.FirstOrDefault(e => e.Selected);

        mailMessages = new List<MailMessage>
        {
            new() { Avatar = "_content/AppBlueprint.UiKit/images/user-40-11.jpg", Name = "Dominik Lamakani", Email = "dominiklama@acme.com", Date = "Sep 3, 3:18 PM", Recipients = new[] { "me", "Carolyn" }, Message = "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis laboris nisi ut aliquip ex ea commodo consequat.</p><p>Cheers,</p><p class=\"font-medium\">Dominik Lamakani</p>" },
            new() { Avatar = "_content/AppBlueprint.UiKit/images/user-avatar-80.png", Name = "Acme Inc.", Email = "acmeinc@acme.com", Date = "Sep 3, 3:18 PM", Recipients = new[] { "me", "Dominik" }, Message = "<p>Dominik, lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p><p>Cheers,</p><p class=\"font-medium\">Acme Inc.</p>" },
            new() { Avatar = "_content/AppBlueprint.UiKit/images/user-40-11.jpg", Name = "Dominik Lamakani", Email = "dominiklama@acme.com", Date = "Sep 4, 3:37 AM", Recipients = new[] { "me", "Carolyn" }, Message = "<p>Hey Acme</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p><p>Cheers,</p><p class=\"font-medium\">Dominik Lamakani</p>" },
        };
    }

    private void SelectEmail(EmailItem email)
    {
        foreach (var e in emails) e.Selected = false;
        email.Selected = true;
        selectedEmail = email;
        inboxSidebarOpen = false;
    }

    private class EmailItem
    {
        public string Avatar { get; set; } = "";
        public string Sender { get; set; } = "";
        public string Date { get; set; } = "";
        public string Subject { get; set; } = "";
        public string Preview { get; set; } = "";
        public bool Selected { get; set; }
    }

    private class MailMessage
    {
        public string Avatar { get; set; } = "";
        public string Name { get; set; } = "";
        public string Email { get; set; } = "";
        public string Date { get; set; } = "";
        public string[] Recipients { get; set; } = Array.Empty<string>();
        public string Message { get; set; } = "";
    }

}

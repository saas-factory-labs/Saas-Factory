@page "/login"
@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>Login - AppBlueprint</PageTitle>

<!-- Show loading screen while redirecting to Logto -->
<div class="login-page-wrapper">
    <MudContainer MaxWidth="MaxWidth.Small" Class="d-flex align-center justify-center" Style="min-height: 100vh;">
        <MudPaper Elevation="3" Class="pa-6 text-center">
            <MudProgressCircular Indeterminate="true" Size="Size.Large" Color="Color.Primary" Class="mb-4" />
            <MudText Typo="Typo.h5" Class="mb-2">Checking authentication...</MudText>
            <MudText Typo="Typo.body2" Color="Color.Secondary">Please wait...</MudText>
        </MudPaper>
    </MudContainer>
</div>

<style>
    .login-page-wrapper {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
</style>

@code {
    protected override async Task OnInitializedAsync()
    {
        // Check if user is already authenticated
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        
        if (user?.Identity?.IsAuthenticated == true)
        {
            Console.WriteLine($"[Login] User already authenticated: {user.Identity.Name} - redirecting to home");
            NavigationManager.NavigateTo("/", forceLoad: true);
        }
        else
        {
            Console.WriteLine("[Login] User not authenticated - redirecting to /signin-logto");
            NavigationManager.NavigateTo("/signin-logto", forceLoad: true);
        }
    }
}


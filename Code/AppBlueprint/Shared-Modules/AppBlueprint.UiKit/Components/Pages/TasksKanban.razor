@page "/tasks/kanban"

<div class="px-4 sm:px-6 lg:px-8 py-8 w-full max-w-[96rem] mx-auto">

    <!-- Page header -->
    <div class="sm:flex sm:justify-between sm:items-center mb-8">
        <div class="mb-4 sm:mb-0">
            <h1 class="text-2xl md:text-3xl text-gray-800 dark:text-gray-100 font-bold">Acme Inc. Kanban</h1>
        </div>
        <div class="grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-4">
            <div class="flex shrink-0 -space-x-3 -ml-px">
                <a class="block" href="#"><img class="rounded-full border-2 border-gray-100 dark:border-gray-900 box-content" src="_content/AppBlueprint.UiKit/images/user-32-08.jpg" width="32" height="32" alt="User 08" /></a>
                <a class="block" href="#"><img class="rounded-full border-2 border-gray-100 dark:border-gray-900 box-content" src="_content/AppBlueprint.UiKit/images/user-32-07.jpg" width="32" height="32" alt="User 07" /></a>
                <a class="block" href="#"><img class="rounded-full border-2 border-gray-100 dark:border-gray-900 box-content" src="_content/AppBlueprint.UiKit/images/user-32-05.jpg" width="32" height="32" alt="User 05" /></a>
                <button class="flex justify-center items-center w-9 h-9 rounded-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-violet-500 shadow-sm transition duration-150 ml-2">
                    <span class="sr-only">Add new user</span>
                    <svg class="w-3 h-3 fill-current" viewBox="0 0 12 12">
                        <path d="M11 5H7V1a1 1 0 0 0-2 0v4H1a1 1 0 0 0 0 2h4v4a1 1 0 0 0 2 0V7h4a1 1 0 0 0 0-2Z" />
                    </svg>
                </button>
            </div>
            <button class="btn bg-violet-500 hover:bg-violet-600 text-white">
                <svg class="w-4 h-4 fill-current opacity-50 shrink-0" viewBox="0 0 16 16">
                    <path d="M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z" />
                </svg>
                <span class="ml-2">Add Task</span>
            </button>
        </div>
    </div>

    <!-- Kanban board -->
    <div class="flex overflow-x-auto no-scrollbar -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8">
        <div class="flex space-x-4 min-w-max">
            @foreach (var column in columns)
            {
                <!-- Column -->
                <div class="w-72 shrink-0">
                    <!-- Column header -->
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="grow font-semibold text-gray-800 dark:text-gray-100 truncate">@column.Title</h2>
                        <button class="shrink-0 text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400">
                            <span class="sr-only">Menu</span>
                            <svg class="w-8 h-8 fill-current" viewBox="0 0 32 32">
                                <circle cx="16" cy="16" r="2" />
                                <circle cx="10" cy="16" r="2" />
                                <circle cx="22" cy="16" r="2" />
                            </svg>
                        </button>
                    </div>

                    <!-- Column content -->
                    <div class="space-y-2">
                        @foreach (var card in column.Cards)
                        {
                            <!-- Card -->
                            <div class="bg-white dark:bg-gray-800 shadow-xs rounded-xl border border-gray-200 dark:border-gray-700 p-4" draggable="true">
                                @if (!string.IsNullOrEmpty(card.Image))
                                {
                                    <div class="mb-3">
                                        <img class="w-full rounded-xl" src="@card.Image" width="258" height="154" alt="Card Image" />
                                    </div>
                                }
                                <div class="mb-3">
                                    <a class="font-semibold text-gray-800 dark:text-gray-100" href="#">@card.Title</a>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        @if (!string.IsNullOrEmpty(card.DueDate))
                                        {
                                            <div class="flex items-center @(card.IsOverdue ? "text-rose-500" : "text-amber-500")">
                                                <svg class="w-4 h-4 shrink-0 fill-current mr-1.5" viewBox="0 0 16 16">
                                                    <path d="M15 2h-2V0h-2v2H9V0H7v2H5V0H3v2H1a1 1 0 00-1 1v12a1 1 0 001 1h14a1 1 0 001-1V3a1 1 0 00-1-1zm-1 12H2V6h12v8z" />
                                                </svg>
                                                <div class="text-sm @(card.IsOverdue ? "text-rose-600" : "text-amber-600")">@card.DueDate</div>
                                            </div>
                                        }
                                        @if (card.Comments > 0)
                                        {
                                            <button class="flex items-center text-gray-400 dark:text-gray-500">
                                                <svg class="w-4 h-4 shrink-0 fill-current mr-1.5" viewBox="0 0 16 16">
                                                    <path d="M8 0C3.6 0 0 3.1 0 7s3.6 7 8 7h.6l5.4 2v-4.4c1.2-1.2 2-2.8 2-4.6 0-3.9-3.6-7-8-7zm4 10.8v2.3L8.9 12H8c-3.3 0-6-2.2-6-5s2.7-5 6-5 6 2.2 6 5c0 2.2-2 3.8-2 3.8z" />
                                                </svg>
                                                <div class="text-sm text-gray-500 dark:text-gray-400">@card.Comments</div>
                                            </button>
                                        }
                                        @if (card.Attachments > 0)
                                        {
                                            <button class="flex items-center text-gray-400 dark:text-gray-500">
                                                <svg class="w-4 h-4 shrink-0 fill-current mr-1.5" viewBox="0 0 16 16">
                                                    <path d="M11 0c1.3 0 2.6.5 3.5 1.5 1 .9 1.5 2.2 1.5 3.5 0 1.3-.5 2.6-1.4 3.5l-1.2 1.2c-.2.2-.5.3-.7.3-.2 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.1-1.2c.6-.5.9-1.3.9-2.1s-.3-1.6-.9-2.2C12 1.7 10 1.7 8.9 2.8L7.7 4c-.4.4-1 .4-1.4 0-.4-.4-.4-1 0-1.4l1.2-1.1C8.4.5 9.7 0 11 0zM8.3 12c.4-.4 1-.5 1.4-.1.4.4.4 1 0 1.4l-1.2 1.2C7.6 15.5 6.3 16 5 16c-1.3 0-2.6-.5-3.5-1.5C.5 13.6 0 12.3 0 11c0-1.3.5-2.6 1.5-3.5l1.1-1.2c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4L2.9 8.9c-.6.5-.9 1.3-.9 2.1s.3 1.6.9 2.2c1.1 1.1 3.1 1.1 4.2 0L8.3 12zm1.1-6.8c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-4.2 4.2c-.2.2-.5.3-.7.3-.2 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l4.2-4.2z" />
                                                </svg>
                                                <div class="text-sm text-gray-500 dark:text-gray-400">@card.Attachments</div>
                                            </button>
                                        }
                                    </div>
                                    @if (card.Avatars.Any())
                                    {
                                        <div class="flex shrink-0 -space-x-3 -ml-px">
                                            @foreach (var avatar in card.Avatars)
                                            {
                                                <a class="block" href="#"><img class="rounded-full border-2 border-white dark:border-gray-800 box-content" src="@avatar" width="24" height="24" alt="User" /></a>
                                            }
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                        <!-- Add card button -->
                        <button class="flex items-center justify-center w-full py-2 px-3 text-sm font-medium text-gray-400 dark:text-gray-500 border border-dashed border-gray-200 dark:border-gray-700 rounded hover:border-gray-300 dark:hover:border-gray-600">
                            <svg class="w-4 h-4 fill-current opacity-50 shrink-0 mr-2" viewBox="0 0 16 16">
                                <path d="M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z" />
                            </svg>
                            <span>Add Card</span>
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>

</div>

@code {
    private List<KanbanColumn> columns = new();

    protected override void OnInitialized()
    {
        columns = new List<KanbanColumn>
        {
            new()
            {
                Title = "Backlog",
                Cards = new List<KanbanCard>
                {
                    new() { Title = "Product Update - Q4 2021", DueDate = "Dec 31", Comments = 2, Avatars = new[] { "_content/AppBlueprint.UiKit/images/user-32-07.jpg" } },
                    new() { Title = "Senior Software Engineer Backend", Comments = 22, Avatars = new[] { "_content/AppBlueprint.UiKit/images/user-32-08.jpg", "_content/AppBlueprint.UiKit/images/user-32-05.jpg" } },
                    new() { Title = "User should receive a daily digest email", DueDate = "Jan 5", IsOverdue = true, Attachments = 1 }
                }
            },
            new()
            {
                Title = "In Progress",
                Cards = new List<KanbanCard>
                {
                    new() { Title = "Managing teams (book)", Image = "_content/AppBlueprint.UiKit/images/kanban-image-01.jpg", DueDate = "Jan 20", Comments = 4, Avatars = new[] { "_content/AppBlueprint.UiKit/images/user-32-05.jpg" } },
                    new() { Title = "Design marketing assets", DueDate = "Feb 10", Comments = 7, Attachments = 3, Avatars = new[] { "_content/AppBlueprint.UiKit/images/user-32-07.jpg", "_content/AppBlueprint.UiKit/images/user-32-08.jpg" } }
                }
            },
            new()
            {
                Title = "Review",
                Cards = new List<KanbanCard>
                {
                    new() { Title = "Change license and remove products", Comments = 8, Avatars = new[] { "_content/AppBlueprint.UiKit/images/user-32-08.jpg" } }
                }
            },
            new()
            {
                Title = "Done",
                Cards = new List<KanbanCard>
                {
                    new() { Title = "Design new diagrams", Comments = 3, Avatars = new[] { "_content/AppBlueprint.UiKit/images/user-32-07.jpg" } },
                    new() { Title = "Update the contact page", Comments = 12, Avatars = new[] { "_content/AppBlueprint.UiKit/images/user-32-05.jpg", "_content/AppBlueprint.UiKit/images/user-32-08.jpg" } }
                }
            }
        };
    }

    private class KanbanColumn
    {
        public string Title { get; set; } = "";
        public List<KanbanCard> Cards { get; set; } = new();
    }

    private class KanbanCard
    {
        public string Title { get; set; } = "";
        public string Image { get; set; } = "";
        public string DueDate { get; set; } = "";
        public bool IsOverdue { get; set; }
        public int Comments { get; set; }
        public int Attachments { get; set; }
        public string[] Avatars { get; set; } = Array.Empty<string>();
    }
}

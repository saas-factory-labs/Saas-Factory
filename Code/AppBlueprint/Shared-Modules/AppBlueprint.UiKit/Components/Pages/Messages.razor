@page "/messages"

<div class="relative flex h-full">

    <!-- Messages sidebar -->
    <div id="messages-sidebar"
         class="absolute z-20 top-0 bottom-0 w-full md:w-auto md:static md:top-auto md:bottom-auto -mr-px md:translate-x-0 transition-transform duration-200 ease-in-out @(msgSidebarOpen ? "translate-x-0" : "-translate-x-full")">
        <div class="sticky top-16 bg-white dark:bg-gray-900 overflow-x-hidden overflow-y-auto no-scrollbar shrink-0 border-r border-gray-200 dark:border-gray-700 md:w-72 xl:w-80 h-[calc(100dvh-64px)]">

            <!-- Group header -->
            <div class="sticky top-0 z-10">
                <div class="flex items-center bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-5 h-16">
                    <div class="w-full flex items-center justify-between">
                        <!-- Channel menu -->
                        <div class="relative inline-flex">
                            <button class="btn justify-between min-w-44 bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-gray-500 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-200">
                                <span class="flex items-center">
                                    <span># Marketing</span>
                                </span>
                                <svg class="shrink-0 ml-1 fill-current text-gray-400" width="11" height="7" viewBox="0 0 11 7">
                                    <path d="M5.4 6.8L0 1.4 1.4 0l4 4 4-4 1.4 1.4z" />
                                </svg>
                            </button>
                        </div>
                        <!-- Edit button -->
                        <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                            <svg class="w-4 h-4 fill-current text-gray-500" viewBox="0 0 16 16">
                                <path d="M11.7.3c-.4-.4-1-.4-1.4 0l-10 10c-.2.2-.3.4-.3.7v4c0 .6.4 1 1 1h4c.3 0 .5-.1.7-.3l10-10c.4-.4.4-1 0-1.4l-4-4zM4.6 14H2v-2.6l6-6L10.6 8l-6 6zM12 6.6L9.4 4 11 2.4 13.6 5 12 6.6z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Group body -->
            <div class="px-5 py-4">
                <!-- Search form -->
                <form class="relative">
                    <label for="msg-search" class="sr-only">Search</label>
                    <input id="msg-search" class="form-input w-full pl-9 bg-white dark:bg-gray-800" type="search" placeholder="Search..." />
                    <button class="absolute inset-0 right-auto group" type="submit" aria-label="Search">
                        <svg class="w-4 h-4 shrink-0 fill-current text-gray-400 dark:text-gray-500 group-hover:text-gray-500 dark:group-hover:text-gray-400 ml-3 mr-2" viewBox="0 0 16 16">
                            <path d="M7 14c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zM7 2C4.243 2 2 4.243 2 7s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5z" />
                            <path d="M15.707 14.293L13.314 11.9a8.019 8.019 0 01-1.414 1.414l2.393 2.393a.997.997 0 001.414 0 .999.999 0 000-1.414z" />
                        </svg>
                    </button>
                </form>

                <!-- Direct messages -->
                <div class="mt-4">
                    <div class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase mb-3">Direct messages</div>
                    <ul class="mb-6">
                        @foreach (var dm in directMessages)
                        {
                            <li class="-mx-2">
                                <button class="flex items-center justify-between w-full p-2 rounded @(dm.Selected ? "bg-violet-100 dark:bg-violet-500/30" : "")" @onclick="() => SelectConversation(dm)">
                                    <div class="flex items-center truncate">
                                        <img class="w-8 h-8 rounded-full mr-2" src="@dm.Avatar" width="32" height="32" alt="@dm.Name" />
                                        <div class="truncate">
                                            <span class="text-sm font-medium text-gray-800 dark:text-gray-100">@dm.Name</span>
                                        </div>
                                    </div>
                                    @if (dm.Online)
                                    {
                                        <div class="flex items-center ml-2">
                                            <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
                                        </div>
                                    }
                                </button>
                            </li>
                        }
                    </ul>
                </div>

                <!-- Channels -->
                <div class="mt-4">
                    <div class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase mb-3">Channels</div>
                    <ul class="mb-6">
                        @foreach (var channel in channels)
                        {
                            <li class="-mx-2">
                                <button class="flex items-center justify-between w-full p-2 rounded @(channel.Selected ? "bg-violet-100 dark:bg-violet-500/30" : "")" @onclick="() => SelectChannel(channel)">
                                    <div class="flex items-center truncate">
                                        <div class="truncate">
                                            <span class="text-sm font-medium text-gray-800 dark:text-gray-100"># @channel.Name</span>
                                        </div>
                                    </div>
                                </button>
                            </li>
                        }
                    </ul>
                </div>
            </div>

        </div>
    </div>

    <!-- Messages body -->
    <div class="grow flex flex-col md:translate-x-0 transition-transform duration-300 ease-in-out @(msgSidebarOpen ? "translate-x-1/3" : "translate-x-0")">

        <!-- Header -->
        <div class="sticky top-16">
            <div class="flex items-center justify-between bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 sm:px-6 md:px-5 h-16">
                <!-- People -->
                <div class="flex items-center">
                    <!-- Close button -->
                    <button class="md:hidden text-gray-400 hover:text-gray-500 mr-4" @onclick="() => msgSidebarOpen = !msgSidebarOpen">
                        <span class="sr-only">Close sidebar</span>
                        <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24">
                            <path d="M10.7 18.7l1.4-1.4L7.8 13H20v-2H7.8l4.3-4.3-1.4-1.4L4 12z" />
                        </svg>
                    </button>
                    <div class="flex -space-x-3 -ml-px">
                        <a class="block" href="#0">
                            <img class="rounded-full border-2 border-white dark:border-gray-800 box-content" src="_content/AppBlueprint.UiKit/cruip/images/user-32-01.jpg" width="32" height="32" alt="User 01" />
                        </a>
                        <a class="block" href="#0">
                            <img class="rounded-full border-2 border-white dark:border-gray-800 box-content" src="_content/AppBlueprint.UiKit/cruip/images/user-32-02.jpg" width="32" height="32" alt="User 02" />
                        </a>
                        <a class="block" href="#0">
                            <img class="rounded-full border-2 border-white dark:border-gray-800 box-content" src="_content/AppBlueprint.UiKit/cruip/images/user-32-03.jpg" width="32" height="32" alt="User 03" />
                        </a>
                        <a class="block" href="#0">
                            <img class="rounded-full border-2 border-white dark:border-gray-800 box-content" src="_content/AppBlueprint.UiKit/cruip/images/user-32-04.jpg" width="32" height="32" alt="User 04" />
                        </a>
                    </div>
                </div>
                <!-- Buttons on the right side -->
                <div class="flex">
                    <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                        <svg class="w-4 h-4 fill-current text-gray-400 dark:text-gray-500" viewBox="0 0 16 16">
                            <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 12c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm1-3H7V4h2v5z" />
                        </svg>
                    </button>
                    <button class="p-1.5 shrink-0 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 shadow-sm ml-2">
                        <svg class="w-4 h-4 fill-current text-violet-500" viewBox="0 0 16 16">
                            <path d="M14.3 2.3L5 11.6 1.7 8.3c-.4-.4-1-.4-1.4 0-.4.4-.4 1 0 1.4l4 4c.2.2.4.3.7.3.3 0 .5-.1.7-.3l10-10c.4-.4.4-1 0-1.4-.4-.4-1-.4-1.4 0z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Body -->
        <div class="grow px-4 sm:px-6 md:px-5 py-6">
            @foreach (var msg in messages)
            {
                <!-- Chat msg -->
                <div class="flex items-start mb-4 last:mb-0">
                    <img class="rounded-full mr-4" src="@msg.Avatar" width="40" height="40" alt="@msg.Name" />
                    <div>
                        <div class="flex items-center mb-1">
                            <span class="text-sm font-medium text-gray-800 dark:text-gray-100 mr-2">@msg.Name</span>
                            <span class="text-xs text-gray-500">@msg.Time</span>
                        </div>
                        <div class="text-sm bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 p-3 rounded-lg rounded-tl-none border border-gray-200 dark:border-gray-700 shadow-sm mb-1">
                            @msg.Content
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Footer -->
        <div class="sticky bottom-0">
            <div class="flex items-center justify-between bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 px-4 sm:px-6 md:px-5 h-16">
                <!-- Plus button -->
                <button class="shrink-0 text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400 mr-3">
                    <span class="sr-only">Add</span>
                    <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12C23.98 5.38 18.62.02 12 0zm6 13h-5v5h-2v-5H6v-2h5V6h2v5h5v2z" />
                    </svg>
                </button>
                <!-- Message input -->
                <form class="grow flex">
                    <div class="grow mr-3">
                        <label for="message-input" class="sr-only">Type a message</label>
                        <input id="message-input" class="form-input w-full bg-gray-100 dark:bg-gray-800 border-transparent dark:border-transparent focus:bg-white dark:focus:bg-gray-800 placeholder-gray-500" type="text" placeholder="Aa" />
                    </div>
                    <button type="submit" class="btn bg-violet-500 hover:bg-violet-600 text-white whitespace-nowrap">Send -&gt;</button>
                </form>
            </div>
        </div>

    </div>

</div>

@code {
    private bool msgSidebarOpen = true;
    private List<DirectMessage> directMessages = new();
    private List<Channel> channels = new();
    private List<Message> messages = new();

    protected override void OnInitialized()
    {
        directMessages = new List<DirectMessage>
        {
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-32-01.jpg", Name = "Dominik Lamakani", Online = true, Selected = true },
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-32-02.jpg", Name = "Tisha Yanchev", Online = true },
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-32-03.jpg", Name = "Jerzy Wierzy", Online = false },
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-32-04.jpg", Name = "Adrian Przetocki", Online = true },
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-32-05.jpg", Name = "Simona LÃ¼rwer", Online = false },
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-32-06.jpg", Name = "Mary Roszczewski", Online = true },
        };

        channels = new List<Channel>
        {
            new() { Name = "Marketing" },
            new() { Name = "Developing" },
            new() { Name = "Productboard" },
        };

        messages = new List<Message>
        {
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-40-11.jpg", Name = "Dominik Lamakani", Time = "11:42 AM", Content = "Hey, can anyone help? I have a question about Acme Professional" },
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-40-12.jpg", Name = "Tisha Yanchev", Time = "11:43 AM", Content = "Sure! What's up?" },
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-40-11.jpg", Name = "Dominik Lamakani", Time = "11:45 AM", Content = "I'm trying to understand how the analytics dashboard works. Do you have any documentation?" },
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-40-12.jpg", Name = "Tisha Yanchev", Time = "11:48 AM", Content = "Yes! I can share the docs with you. Give me a moment." },
            new() { Avatar = "_content/AppBlueprint.UiKit/cruip/images/user-40-12.jpg", Name = "Tisha Yanchev", Time = "11:50 AM", Content = "Here you go: https://docs.acme.com/analytics - Let me know if you have any questions!" },
        };
    }

    private void SelectConversation(DirectMessage dm)
    {
        foreach (var d in directMessages) d.Selected = false;
        foreach (var c in channels) c.Selected = false;
        dm.Selected = true;
        msgSidebarOpen = false;
    }

    private void SelectChannel(Channel channel)
    {
        foreach (var d in directMessages) d.Selected = false;
        foreach (var c in channels) c.Selected = false;
        channel.Selected = true;
        msgSidebarOpen = false;
    }

    private class DirectMessage
    {
        public string Avatar { get; set; } = "";
        public string Name { get; set; } = "";
        public bool Online { get; set; }
        public bool Selected { get; set; }
    }

    private class Channel
    {
        public string Name { get; set; } = "";
        public bool Selected { get; set; }
    }

    private class Message
    {
        public string Avatar { get; set; } = "";
        public string Name { get; set; } = "";
        public string Time { get; set; } = "";
        public string Content { get; set; } = "";
    }
}

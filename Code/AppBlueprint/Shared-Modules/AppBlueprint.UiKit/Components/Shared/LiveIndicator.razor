@namespace AppBlueprint.UiKit.Components.Shared

@* Live indicator with pulsing dot - reusable for real-time counters *@

<div class="flex items-center">
    <!-- Animated pulsing dot -->
    <div class="relative flex items-center justify-center @GetDotSizeClass() mr-3" aria-hidden="true">
        <div class="animate-ping absolute inline-flex h-full w-full rounded-full @GetPingColorClass() opacity-50"></div>
        <div class="relative inline-flex rounded-full @GetInnerDotSizeClass() @GetDotColorClass()"></div>
    </div>
    <!-- Counter and label -->
    <div>
        @if (!string.IsNullOrEmpty(CustomCountDisplay))
        {
            <div class="@GetCountTextSizeClass() font-bold text-gray-800 dark:text-gray-100 mr-2">@CustomCountDisplay</div>
        }
        else
        {
            <div class="@GetCountTextSizeClass() font-bold text-gray-800 dark:text-gray-100 mr-2">@Count.ToString("N0")</div>
        }
        <div class="@GetLabelTextSizeClass() text-gray-500 dark:text-gray-400">@GetEffectiveLabel()</div>
    </div>
</div>

@code {
    /// <summary>
    /// The live count to display
    /// </summary>
    [Parameter]
    public int Count { get; set; }

    /// <summary>
    /// Custom count display (e.g., "247+", "1.2K") - overrides Count parameter
    /// </summary>
    [Parameter]
    public string? CustomCountDisplay { get; set; }

    /// <summary>
    /// Label text (e.g., "Live visitors", "Online now", "Active users")
    /// </summary>
    [Parameter]
    public string? Label { get; set; }

    /// <summary>
    /// Status alias for Color
    /// </summary>
    [Parameter]
    public string? Status { get; set; }

    /// <summary>
    /// Size variant: small, medium, large
    /// </summary>
    [Parameter]
    public string Size { get; set; } = "large";

    /// <summary>
    /// Color variant: red, green, blue, amber, violet
    /// </summary>
    [Parameter]
    public string Color { get; set; } = "red";

    private string GetEffectiveLabel() => Label ?? Status ?? "Live";

    private string GetEffectiveColor()
    {
        var status = (Status ?? Color).ToLower();
        return status switch
        {
            "online" or "active" or "success" => "green",
            "offline" or "inactive" or "error" => "red",
            "away" or "pending" or "warning" => "amber",
            "busy" or "info" => "blue",
            _ => status
        };
    }

    private string GetDotSizeClass()
    {
        return Size.ToLower() switch
        {
            "small" => "w-2 h-2",
            "medium" => "w-2.5 h-2.5",
            "large" => "w-3 h-3",
            _ => "w-3 h-3"
        };
    }

    private string GetInnerDotSizeClass()
    {
        return Size.ToLower() switch
        {
            "small" => "w-1 h-1",
            "medium" => "w-1.5 h-1.5",
            "large" => "w-1.5 h-1.5",
            _ => "w-1.5 h-1.5"
        };
    }

    private string GetCountTextSizeClass()
    {
        return Size.ToLower() switch
        {
            "small" => "text-xl",
            "medium" => "text-2xl",
            "large" => "text-3xl",
            _ => "text-3xl"
        };
    }

    private string GetLabelTextSizeClass()
    {
        return Size.ToLower() switch
        {
            "small" => "text-xs",
            "medium" => "text-sm",
            "large" => "text-sm",
            _ => "text-sm"
        };
    }

    private string GetPingColorClass()
    {
        return GetEffectiveColor().ToLower() switch
        {
            "red" => "bg-red-400",
            "green" or "emerald" => "bg-emerald-400",
            "blue" => "bg-blue-400",
            "amber" or "yellow" => "bg-amber-400",
            "violet" or "purple" => "bg-violet-400",
            _ => "bg-red-400"
        };
    }

    private string GetDotColorClass()
    {
        return GetEffectiveColor().ToLower() switch
        {
            "red" => "bg-red-500",
            "green" or "emerald" => "bg-emerald-500",
            "blue" => "bg-blue-500",
            "amber" or "yellow" => "bg-amber-500",
            "violet" or "purple" => "bg-violet-500",
            _ => "bg-red-500"
        };
    }
}

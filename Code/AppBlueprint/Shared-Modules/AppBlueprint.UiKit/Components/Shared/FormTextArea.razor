@* TextArea component with label and validation *@

<div class="@ContainerClass">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="block text-sm font-medium mb-1 @LabelClasses" for="@Id">
            @Label
            @if (Required)
            {
                <span class="text-red-500">*</span>
            }
        </label>
    }
    <textarea
        id="@Id"
        name="@Name"
        class="@GetTextAreaClasses()"
        placeholder="@Placeholder"
        rows="@Rows"
        disabled="@Disabled"
        readonly="@Readonly"
        required="@Required"
        @oninput="OnInput"
        @attributes="AdditionalAttributes">@Value</textarea>
    @if (!string.IsNullOrEmpty(HelpText) && !HasError)
    {
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">@HelpText</p>
    }
    @if (HasError && !string.IsNullOrEmpty(ErrorMessage))
    {
        <p class="text-xs text-red-500 mt-1">@ErrorMessage</p>
    }
</div>

@code {
    [Parameter] public string? Id { get; set; }
    [Parameter] public string? Name { get; set; }
    [Parameter] public string? Label { get; set; }
    [Parameter] public string? Placeholder { get; set; }
    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    [Parameter] public int Rows { get; set; } = 4;
    [Parameter] public string? HelpText { get; set; }
    [Parameter] public string? ErrorMessage { get; set; }
    [Parameter] public bool HasError { get; set; } = false;
    [Parameter] public bool Disabled { get; set; } = false;
    [Parameter] public bool Readonly { get; set; } = false;
    [Parameter] public bool Required { get; set; } = false;
    [Parameter] public bool Resizable { get; set; } = true;
    [Parameter] public string? ContainerClass { get; set; }
    [Parameter(CaptureUnmatchedValues = true)] public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string LabelClasses => HasError ? "text-red-500" : "text-gray-800 dark:text-gray-100";

    private string GetTextAreaClasses()
    {
        var resizeClass = Resizable ? "resize-y" : "resize-none";

        var stateClasses = HasError
            ? "border-red-500 focus:border-red-500 focus:ring-red-500/20"
            : Disabled
                ? "border-gray-200 dark:border-gray-700/60 bg-gray-100 dark:bg-gray-900/50 text-gray-400 cursor-not-allowed"
                : "border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 focus:border-violet-300 dark:focus:border-violet-500/50";

        return $"form-textarea w-full px-3 py-2 text-sm bg-white dark:bg-gray-800 {stateClasses} rounded-lg {resizeClass}";
    }

    private async Task OnInput(ChangeEventArgs e)
    {
        Value = e.Value?.ToString();
        await ValueChanged.InvokeAsync(Value);
    }
}

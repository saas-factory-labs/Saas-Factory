@* Tabs container component *@

<div>
    <div class="@GetTabListClasses()" role="tablist" aria-orientation="horizontal">
        <CascadingValue Value="this" IsFixed="true">
            @ChildContent
        </CascadingValue>

        @foreach (var tab in GetDisplayTabs())
        {
            <button
                type="button"
                role="tab"
                class="@GetTabClasses(tab.Id == ActiveTab)"
                aria-selected="@(tab.Id == ActiveTab)"
                @onclick="() => SetActiveTab(tab.Id)">
                @tab.Label
            </button>
        }
    </div>
    <div class="mt-4">
        @ChildContent
    </div>
</div>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public List<TabItem> TabItems { get; set; } = new();
    [Parameter] public string ActiveTab { get; set; } = "";
    [Parameter] public EventCallback<string> ActiveTabChanged { get; set; }
    [Parameter] public string Variant { get; set; } = "underline"; // underline, pills

    private List<TabItem> registeredTabs = new();

    protected override void OnInitialized()
    {
        if (string.IsNullOrEmpty(ActiveTab) && !registeredTabs.Any() && TabItems.Any())
        {
            ActiveTab = TabItems.First().Id;
        }
    }

    public void AddTab(TabItem tab)
    {
        if (!registeredTabs.Any(t => t.Id == tab.Id && t.Label == tab.Label))
        {
            registeredTabs.Add(tab);
            if (string.IsNullOrEmpty(ActiveTab) || tab.IsActive)
            {
                ActiveTab = tab.Id;
            }
            StateHasChanged();
        }
    }

    private List<TabItem> GetDisplayTabs()
    {
        return registeredTabs.Any() ? registeredTabs : TabItems;
    }

    private async Task SetActiveTab(string tabId)
    {
        ActiveTab = tabId;
        await ActiveTabChanged.InvokeAsync(tabId);
    }

    private string GetTabListClasses()
    {
        return Variant switch
        {
            "pills" => "flex flex-wrap gap-2",
            _ => "flex flex-wrap border-b border-gray-200 dark:border-gray-700/60"
        };
    }

    private string GetTabClasses(bool isActive)
    {
        return Variant switch
        {
            "pills" => isActive
                ? "px-3 py-1.5 text-sm font-medium rounded-lg bg-violet-500 text-white"
                : "px-3 py-1.5 text-sm font-medium rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700/50",
            _ => isActive
                ? "px-4 py-2 text-sm font-medium text-violet-500 border-b-2 border-violet-500 -mb-px"
                : "px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"
        };
    }

    public class TabItem
    {
        public string Id { get; set; } = "";
        public string Label { get; set; } = "";
        public string? Icon { get; set; }
        public bool IsActive { get; set; }
    }
}

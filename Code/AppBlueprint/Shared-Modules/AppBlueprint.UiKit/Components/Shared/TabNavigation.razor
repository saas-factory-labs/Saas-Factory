@* Tab Navigation component for page sections *@
@inject NavigationManager Navigation

<div class="@ContainerClass">
    @* Tab list *@
    <div class="@GetTabListClasses()" role="tablist">
        @foreach (var tab in Tabs)
        {
            var isActive = ActiveTab == tab.Id;
            <button type="button"
                    role="tab"
                    aria-selected="@isActive"
                    aria-controls="@($"panel-{tab.Id}")"
                    class="@GetTabClasses(isActive)"
                    @onclick="() => SelectTab(tab)">
                @if (tab.Icon != null)
                {
                    <span class="@GetTabIconClasses(isActive)">
                        @tab.Icon
                    </span>
                }
                <span>@tab.Label</span>
                @if (tab.Badge != null)
                {
                    <span class="@GetBadgeClasses(isActive)">@tab.Badge</span>
                }
            </button>
        }
    </div>

    @* Tab panels *@
    @if (ShowPanels && ChildContent != null)
    {
        <div class="@PanelContainerClass">
            @ChildContent
        </div>
    }
</div>

@code {
    [Parameter] public List<TabItem> Tabs { get; set; } = new();
    [Parameter] public string? ActiveTab { get; set; }
    [Parameter] public EventCallback<string> ActiveTabChanged { get; set; }
    [Parameter] public EventCallback<TabItem> OnTabChanged { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public bool ShowPanels { get; set; } = true;
    [Parameter] public string Variant { get; set; } = "underline"; // underline, pills, boxed, minimal
    [Parameter] public string Size { get; set; } = "md"; // sm, md, lg
    [Parameter] public bool FullWidth { get; set; } = false;
    [Parameter] public bool UseRouting { get; set; } = false;
    [Parameter] public string? ContainerClass { get; set; }
    [Parameter] public string? PanelContainerClass { get; set; }

    protected override void OnInitialized()
    {
        if (string.IsNullOrEmpty(ActiveTab) && Tabs.Any())
        {
            ActiveTab = Tabs.First().Id;
        }
    }

    private async Task SelectTab(TabItem tab)
    {
        if (tab.Disabled) return;

        ActiveTab = tab.Id;
        await ActiveTabChanged.InvokeAsync(tab.Id);
        await OnTabChanged.InvokeAsync(tab);

        if (UseRouting && !string.IsNullOrEmpty(tab.Href))
        {
            Navigation.NavigateTo(tab.Href);
        }
    }

    private string GetTabListClasses()
    {
        const string baseClasses = "flex";

        var variantClasses = Variant switch
        {
            "pills" => "gap-2 p-1 bg-gray-100 dark:bg-gray-700/30 rounded-lg",
            "boxed" => "border-b border-gray-200 dark:border-gray-700",
            "minimal" => "gap-4",
            _ => "border-b border-gray-200 dark:border-gray-700 gap-6" // underline
        };

        var widthClass = FullWidth ? "w-full" : "";

        return $"{baseClasses} {variantClasses} {widthClass}";
    }

    private string GetTabClasses(bool isActive)
    {
        var sizeClasses = Size switch
        {
            "sm" => "px-3 py-1.5 text-xs",
            "lg" => "px-5 py-3 text-base",
            _ => "px-4 py-2.5 text-sm"
        };

        var widthClass = FullWidth ? "flex-1 justify-center" : "";

        var variantClasses = Variant switch
        {
            "pills" => isActive
                ? "bg-white dark:bg-gray-800 text-violet-600 dark:text-violet-400 shadow-sm rounded-md font-medium"
                : "text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 rounded-md",
            "boxed" => isActive
                ? "bg-gray-50 dark:bg-gray-800 border-t border-l border-r border-gray-200 dark:border-gray-700 -mb-px text-violet-600 dark:text-violet-400 font-medium rounded-t-lg"
                : "text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-t-lg",
            "minimal" => isActive
                ? "text-violet-600 dark:text-violet-400 font-medium"
                : "text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",
            _ => isActive // underline
                ? "border-b-2 border-violet-500 text-violet-600 dark:text-violet-400 font-medium -mb-px"
                : "text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 -mb-px"
        };

        return $"flex items-center gap-2 transition-all whitespace-nowrap {sizeClasses} {variantClasses} {widthClass}";
    }

    private string GetTabIconClasses(bool isActive)
    {
        return isActive
            ? "text-violet-500 dark:text-violet-400"
            : "text-gray-400 dark:text-gray-500";
    }

    private string GetBadgeClasses(bool isActive)
    {
        const string baseClasses = "ml-1 px-1.5 py-0.5 text-xs font-medium rounded-full";

        return isActive
            ? $"{baseClasses} bg-violet-100 dark:bg-violet-500/20 text-violet-600 dark:text-violet-400"
            : $"{baseClasses} bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400";
    }

    public class TabItem
    {
        public string Id { get; set; } = "";
        public string Label { get; set; } = "";
        public RenderFragment? Icon { get; set; }
        public string? Badge { get; set; }
        public string? Href { get; set; }
        public bool Disabled { get; set; } = false;
    }
}

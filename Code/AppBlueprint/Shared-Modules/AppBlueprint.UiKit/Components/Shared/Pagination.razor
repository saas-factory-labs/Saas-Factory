@* Standalone pagination component *@

<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    @if (ShowInfo)
    {
        <div class="text-sm text-gray-500 dark:text-gray-400">
            Showing <span class="font-medium text-gray-600 dark:text-gray-300">@StartIndex</span> to <span class="font-medium text-gray-600 dark:text-gray-300">@EndIndex</span> of <span class="font-medium text-gray-600 dark:text-gray-300">@TotalItems</span> results
        </div>
    }
    <nav class="flex items-center gap-1" aria-label="Pagination">
        <button class="@GetPaginationButtonClasses(CurrentPage == 1)"
                disabled="@(CurrentPage == 1)"
                @onclick="() => GoToPage(CurrentPage - 1)">
            <span class="sr-only">Previous</span>
            <svg class="fill-current" width="4" height="7" viewBox="0 0 4 7">
                <path d="M3.7.3c.4.4.4 1 0 1.4L1.4 4l2.3 2.3c.4.4.4 1 0 1.4-.4.4-1 .4-1.4 0L.3 5.7c-.4-.4-.4-1 0-1.4L2.3.3c.4-.4 1-.4 1.4 0z" />
            </svg>
        </button>
        @foreach (var pageNum in GetPageNumbers())
        {
            @if (pageNum == -1)
            {
                <span class="px-2 text-gray-400">...</span>
            }
            else
            {
                <button class="@GetPageNumberClasses(pageNum == CurrentPage)"
                        @onclick="() => GoToPage(pageNum)">
                    @pageNum
                </button>
            }
        }
        <button class="@GetPaginationButtonClasses(CurrentPage == TotalPages)"
                disabled="@(CurrentPage == TotalPages)"
                @onclick="() => GoToPage(CurrentPage + 1)">
            <span class="sr-only">Next</span>
            <svg class="fill-current" width="4" height="7" viewBox="0 0 4 7">
                <path d="M.3 6.7c-.4-.4-.4-1 0-1.4L2.6 3 .3.7C-.1.3-.1-.3.3-.7c.4-.4 1-.4 1.4 0l2 2c.4.4.4 1 0 1.4l-2 2c-.4.4-1 .4-1.4 0z" />
            </svg>
        </button>
    </nav>
</div>

@code {
    [Parameter] public int CurrentPage { get; set; } = 1;
    [Parameter] public int TotalItems { get; set; }
    [Parameter] public int PageSize { get; set; } = 10;
    [Parameter] public bool ShowInfo { get; set; } = true;
    [Parameter] public EventCallback<int> CurrentPageChanged { get; set; }

    private int TotalPages => (int)Math.Ceiling(TotalItems / (double)PageSize);
    private int StartIndex => TotalItems > 0 ? (CurrentPage - 1) * PageSize + 1 : 0;
    private int EndIndex => Math.Min(CurrentPage * PageSize, TotalItems);

    private async Task GoToPage(int page)
    {
        var newPage = Math.Clamp(page, 1, TotalPages);
        if (newPage != CurrentPage)
        {
            CurrentPage = newPage;
            await CurrentPageChanged.InvokeAsync(CurrentPage);
        }
    }

    private List<int> GetPageNumbers()
    {
        var pages = new List<int>();
        var maxVisible = 5;

        if (TotalPages <= maxVisible)
        {
            for (int i = 1; i <= TotalPages; i++)
                pages.Add(i);
        }
        else
        {
            pages.Add(1);
            if (CurrentPage > 3) pages.Add(-1);

            var start = Math.Max(2, CurrentPage - 1);
            var end = Math.Min(TotalPages - 1, CurrentPage + 1);

            for (int i = start; i <= end; i++)
                pages.Add(i);

            if (CurrentPage < TotalPages - 2) pages.Add(-1);
            pages.Add(TotalPages);
        }

        return pages;
    }

    private string GetPaginationButtonClasses(bool disabled)
    {
        var baseClasses = "inline-flex items-center justify-center rounded-lg leading-5 px-2.5 py-2 border";
        return disabled
            ? $"{baseClasses} border-gray-200 dark:border-gray-700/60 text-gray-300 dark:text-gray-600"
            : $"{baseClasses} border-gray-200 dark:border-gray-700/60 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50";
    }

    private string GetPageNumberClasses(bool isActive)
    {
        var baseClasses = "inline-flex items-center justify-center rounded-lg leading-5 px-3.5 py-2";
        return isActive
            ? $"{baseClasses} bg-violet-500 text-white"
            : $"{baseClasses} text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700/50";
    }
}

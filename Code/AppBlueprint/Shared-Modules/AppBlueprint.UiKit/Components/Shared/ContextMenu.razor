@* Context menu component (right-click menu) *@
@using Microsoft.JSInterop
@inject IJSRuntime JS

<div class="@ContainerClass" @oncontextmenu="OnContextMenu" @oncontextmenu:preventDefault="true">
    @ChildContent

    @if (IsOpen)
    {
        @* Backdrop to catch clicks outside *@
        <div class="fixed inset-0 z-40" @onclick="Close"></div>

        @* Context menu *@
        <div class="fixed z-50 min-w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700/60 rounded-lg shadow-lg overflow-hidden py-1.5"
             style="top: @(PositionY)px; left: @(PositionX)px;">
            @MenuContent
        </div>
    }
</div>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? MenuContent { get; set; }
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback<bool> IsOpenChanged { get; set; }
    [Parameter] public string? ContainerClass { get; set; }

    private double PositionX { get; set; }
    private double PositionY { get; set; }

    private async Task OnContextMenu(MouseEventArgs e)
    {
        PositionX = e.ClientX;
        PositionY = e.ClientY;
        IsOpen = true;
        await IsOpenChanged.InvokeAsync(true);
    }

    private async Task Close()
    {
        IsOpen = false;
        await IsOpenChanged.InvokeAsync(false);
    }
}

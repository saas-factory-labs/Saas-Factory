@using AppBlueprint.UiKit.Components.Charts

<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5 @Class">
    <header class="flex justify-between items-start mb-2">
        <div>
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">@Title</h3>
            @if (!string.IsNullOrEmpty(Subtitle))
            {
                <div class="text-xs text-gray-400 dark:text-gray-500">@Subtitle</div>
            }
        </div>
        @if (HeaderActions != null)
        {
            @HeaderActions
        }
    </header>
    
    @if (ShowSummary && (!string.IsNullOrEmpty(SummaryValue) || !string.IsNullOrEmpty(TrendValue)))
    {
        <div class="flex items-start mb-2">
            @if (!string.IsNullOrEmpty(SummaryValue))
            {
                <div class="text-3xl font-bold text-gray-800 dark:text-gray-100 mr-2">@SummaryValue</div>
            }
            @if (!string.IsNullOrEmpty(TrendValue))
            {
                <div class="text-sm font-medium text-green-700 px-1.5 bg-green-500/20 rounded-full">@TrendValue</div>
            }
        </div>
        @if (!string.IsNullOrEmpty(SummaryLabel))
        {
            <div class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase mb-1">@SummaryLabel</div>
        }
    }

    <div class="grow" style="height: @Height">
        <LineChart Labels="@GetLabels()" Datasets="@GetDatasets()" ShowXAxis="@true" ShowYAxis="@true" UseTimeScale="false" />
    </div>
</div>

@code {
    [Parameter] public string? Title { get; set; } = "Line Chart";
    [Parameter] public string? Subtitle { get; set; }
    [Parameter] public string? SummaryValue { get; set; }
    [Parameter] public string? SummaryLabel { get; set; }
    [Parameter] public string? TrendValue { get; set; }
    [Parameter] public bool ShowSummary { get; set; } = false;
    [Parameter] public bool ShowLegend { get; set; } = false;
    [Parameter] public string Height { get; set; } = "200px";
    [Parameter] public List<string>? Labels { get; set; }
    [Parameter] public List<LineChart.ChartDataset>? Datasets { get; set; }
    [Parameter] public RenderFragment? HeaderActions { get; set; }
    [Parameter] public string? Class { get; set; }

    private List<string> GetLabels() => Labels ?? new List<string> { "Jan", "Feb", "Mar", "Apr", "May", "Jun" };
    
    private List<LineChart.ChartDataset> GetDatasets() => Datasets ?? new List<LineChart.ChartDataset>
    {
        new LineChart.ChartDataset
        {
            Label = Title ?? "Data",
            Data = new List<double> { 65, 59, 80, 81, 56, 55 },
            BorderColor = "rgb(139, 92, 246)",
            BackgroundColor = "rgba(139, 92, 246, 0.1)",
            Fill = false,
            Tension = 0.4
        }
    };
}

@namespace AppBlueprint.UiKit.Components.Shared
@using System.Linq

@code {
    [CascadingParameter] public ActivityFeed? Parent { get; set; }

    [Parameter] public string? Title { get; set; }
    [Parameter] public string? UserName { get; set; }
    [Parameter] public string? AvatarUrl { get; set; }
    [Parameter] public string? Action { get; set; }
    [Parameter] public string? Target { get; set; }
    [Parameter] public string? Description { get; set; }
    [Parameter] public string Time { get; set; } = "";
    [Parameter] public string? Icon { get; set; }
    [Parameter] public string? Type { get; set; }
    [Parameter] public bool ShowBadge { get; set; }
    [Parameter] public string? BadgeType { get; set; }

    protected override void OnInitialized()
    {
        if (Parent != null)
        {
            var item = new ActivityFeed.ActivityItem
            {
                UserName = UserName,
                AvatarUrl = AvatarUrl,
                Action = Action ?? "",
                Target = Target,
                Description = Description,
                Time = Time,
                Type = Type ?? Icon,
                ShowBadge = ShowBadge,
                BadgeType = BadgeType
            };

            if (string.IsNullOrEmpty(item.Action) && !string.IsNullOrEmpty(Title))
            {
                item.Action = Title;
            }

            Parent.AddActivity(item);
        }
    }
}
